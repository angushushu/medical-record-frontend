<template>
    <div class="container">
        <el-upload
            ref="upload"
            action="http://127.0.0.1:8000/api/v1/upload-standards/"
            accept=".xml"
            :limit="1"
            :on-exceed="handleExceed"
            :auto-upload="false"
        >
            <template #trigger>
            <el-button type="primary">select file</el-button>
            </template>
            <el-button class="ml-3" type="success" @click="submitUpload">
            upload to server
            </el-button>
            <template #tip>
            <div class="el-upload__tip text-red">
                limit 1 file, new file will cover the old file
            </div>
            </template>
        </el-upload>
    </div>
</template>

<script lang="ts" setup>
import { ref } from 'vue'
import { genFileId } from 'element-plus'
import type { UploadInstance, UploadProps, UploadRawFile } from 'element-plus'

const upload = ref<UploadInstance>()

const handleExceed: UploadProps['onExceed'] = (files) => {
  upload.value!.clearFiles()
  const file = files[0] as UploadRawFile
  file.uid = genFileId()
  upload.value!.handleStart(file)
}

const submitUpload = () => {
  upload.value!.submit()
}
</script>
